<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Lao&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./style/register.css">
</head>

<body>
    <div class="container">
        <form action="" method="POST">
            <div class="row" style="justify-content: space-evenly; margin-top: 50px; padding: 5px 5px;">
                <div class="col-md-12">
                    <div class="card border-primary">
                        <div class="row">
                            <div class="d-flex" style="margin-left: 5px;">
                                <div class="row">
                                    <div class="form-group">
                                        <h5 style="font-weight: bold;" class="text-primary">ລະຫັດໃບບິນ:&nbsp;&nbsp;</h5>
                                        <input type="text" class="form-control border-primary" id="regisID" readonly
                                            name="regisID" value="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" style="font-weight: bold;">
                                <h5 class="text-center">ລະຫັດນັກຮຽນ:&nbsp;&nbsp;<span id="studentID"></span></h5>
                            </div>
                            <div class="col-md-6" style="font-weight: bold;">
                                <h5 class="text-center">ວັນທີ:&nbsp;&nbsp;<span id="today"></span></h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <input type="hidden" name="studentID" value="" id="studentIDinput">
            <input type="hidden" name="date" value="">
            <div class="row" style="justify-content: space-evenly; margin-top: 10px;">
                <div class="col-md-4">
                    <div class="search-input-container">
                        <div class="input-group">
                            <span class="input-group-text border-primary"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control border-primary" placeholder="ຄົ້ນຫາວິຊາ..."
                                id="searchInput">
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="table table-striped border-primary">
                            <thead class="text-white bg-primary">
                                <tr>
                                    <th>ລະຫັດ</th>
                                    <th>ວິຊາ ແລະ ລະດັບ</th>
                                    <th>ລາຄາວິຊາ</th>
                                    <th>ປຸ່ມເພີ່ມ</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">

                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="table-detail">
                        <table class="table table-striped border-success">
                            <thead class="text-white bg-dark">
                                <tr>
                                    <th>ລະຫັດ</th>
                                    <th>ວິຊາ ແລະ ລະດັບ</th>
                                    <th>ລາຄາວິຊາ</th>
                                    <th>ປຸ່ມລົບ</th>
                                </tr>
                            </thead>
                            <tbody id="tableDetail">

                            </tbody>
                        </table>
                        <input type="hidden" name="regisID" id="regisID">
                        <div class="row mb-5">
                            <div class="col-md-6">
                                <button class="btn btn-primary" type="submit" id="save">ສົ່ງຂໍ້ມູນ</button>
                            </div><br><br>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="">ລວມຈຳນວນເງິນທັງໝົດ:</label>
                                    <input type="text" class="form-control border-primary" name="amount" id="total"
                                        readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <script>
        const today = new Date();
        const day = today.getDate();
        const month = today.getMonth() + 1;
        const year = today.getFullYear();
        const formattedDate = `${day}/${month}/${year}`;
        document.getElementById('today').textContent = formattedDate;
    </script>
    <script src="./script/sendID.js"></script>
    <script src="./script/register.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>

    <!-- <script>
        document.addEventListener('DOMContentLoaded', function () {
            generateStudentID();

            const addButtons = document.querySelectorAll('.btn-info');
            addButtons.forEach(button => {
                button.addEventListener('click', function (event) {
                    event.preventDefault();
                    const row = event.target.closest('tr');
                    const subDetailID = row.querySelector('td:nth-child(1)').textContent;
                    const subjectNameAndLevel = row.querySelector('td:nth-child(2)').textContent;
                    const cost = parseFloat(row.querySelector('td:nth-child(3)').textContent) || 0;

                    const tableDetail = document.getElementById('tableDetail');

                    let exists = false;
                    const existingRows = tableDetail.querySelectorAll('tr');
                    existingRows.forEach(existingRow => {
                        const existingSubDetailID = existingRow.querySelector('td:nth-child(1)').textContent;
                        if (existingSubDetailID === subDetailID) {
                            exists = true;
                        }
                    });

                    if (tableDetail.rows.length >= 4) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'ຂໍອະໄພດ້ວຍ!',
                            text: 'ທ່ານສາມາດເລືອກວິຊາຮຽນໄດ້ບໍ່ເກີນ 3 ວິຊາ.',
                            confirmButtonText: 'ຕົກລົງ'
                        });
                        return;
                    }


                    if (exists) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'ທ່ານໄດ້ເລືອກຮຽນວິຊານີ້ໄປແລ້ວ!',
                            text: 'ກະລຸນາເລືອກວິຊາອື່ນ.',
                            confirmButtonText: 'ຕົກລົງ'
                        });
                    } else {
                        const newRow = tableDetail.insertRow();
                        newRow.insertCell(0).textContent = subDetailID;
                        newRow.insertCell(1).textContent = subjectNameAndLevel;
                        newRow.insertCell(2).textContent = cost;
                        const removeButton = document.createElement('button');
                        removeButton.textContent = 'ຍົກເລີກ';
                        removeButton.className = 'btn btn-danger btn-sm';
                        removeButton.onclick = function () {
                            newRow.remove();
                            removeHiddenInputs(subDetailID, cost);
                            updateTotalAmount();
                        };

                        const removeCell = newRow.insertCell(3);
                        removeCell.appendChild(removeButton);

                        const hiddenSubDetailIDInput = document.createElement('input');
                        hiddenSubDetailIDInput.type = 'hidden';
                        hiddenSubDetailIDInput.name = 'subDetailID[]';
                        hiddenSubDetailIDInput.value = subDetailID;
                        document.querySelector('form').appendChild(hiddenSubDetailIDInput);

                        const hiddenCostInput = document.createElement('input');
                        hiddenCostInput.type = 'hidden';
                        hiddenCostInput.name = 'cost[]';
                        hiddenCostInput.value = cost;
                        document.querySelector('form').appendChild(hiddenCostInput);
                        updateTotalAmount();
                    }
                });
            });

            function removeHiddenInputs(subDetailID) {

                const hiddenSubDetailIDInputs = document.querySelectorAll('input[name="subDetailID[]"]');

                hiddenSubDetailIDInputs.forEach(input => {
                    if (input.value === subDetailID) {
                        input.remove();
                    }
                });

                hiddenCostInputs.forEach(input => {
                    if (input.value === cost.toString()) {
                        input.remove();
                    }
                });
            }

            function updateTotalAmount() {
                let totalAmount = 0;
                const rows = document.querySelectorAll('#tableDetail tr');
                rows.forEach(row => {
                    const costCell = row.querySelector('td:nth-child(3)');
                    if (costCell) {
                        const cost = parseFloat(costCell.textContent) || 0;
                        totalAmount += cost;
                    }
                });
                document.querySelector('input[name="amount"]').value = totalAmount.toFixed(0);
            }



            const form = document.querySelector('form');
            form.addEventListener('submit', function (event) {
                event.preventDefault();
                let billDetails = '';
                const rows = document.querySelectorAll('#tableDetail tr');
                rows.forEach(row => {
                    const subDetailID = row.querySelector('td:nth-child(1)').textContent;
                    const subjectNameAndLevel = row.querySelector('td:nth-child(2)').textContent;
                    const cost = row.querySelector('td:nth-child(3)').textContent;
                    billDetails += `
            <tr>
                <td>${subDetailID}</td>
                <td>${subjectNameAndLevel}</td>
                <td>${cost}</td>
            </tr>
        `;
                });

                Swal.fire({
                    title: 'ກະລຸນາຢືນຢັນ',
                    html: `
            <p><strong></strong> ${document.querySelector('h5.text-center').textContent.replace('&nbsp;&nbsp;', '')}</p>
            <p><strong>ລະຫັດໃບບິນ:</strong> ${document.getElementById('regisID').value}</p>
            <p><strong>ວັນທີ:</strong> ${new Date().toLocaleDateString()}</p>
            <table style="width: 100%; border: 1px solid #ddd; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">ລະຫັດວິຊາ</th>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">ຊື່ວິຊາ ແລ ະລະດັບ</th>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">ລາຄາວິຊາ</th>
                    </tr>
                </thead>
                <tbody>
                    ${billDetails}
                </tbody>
            </table>
            <p><strong>ຈຳນວນທັງໝົດ: ${document.querySelector('input[name="amount"]').value}</strong></p>
            <p><strong>ກະລຸນາກວດສອບຂໍ້ມູນກ່ອນການສົ່ງ.</strong></p>
            <h4 class="text-primary"><strong>ກະລຸນາແຄັບຈໍໄວ້ເປັນຫຼັກຖານ</strong></h4>
        `,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'ຢືນຢັນ',
                    cancelButtonText: 'ຍົກເລີກ'
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    } else {
                        Swal.fire({
                            title: 'ການສົ່ງຂໍ້ມູນຖືກຍົກເລີກ',
                            icon: 'info',
                            confirmButtonText: 'ຕົກລົງ'
                        });
                    }
                });
            });

            document.getElementById('searchInput').addEventListener('input', function () {
                let filter = this.value.toLowerCase();
                let rows = document.querySelectorAll("#tableBody tr");
                rows.forEach(row => {
                    let columns = row.getElementsByTagName("td");
                    let found = false;
                    for (let i = 0; i < columns.length; i++) {
                        if (columns[i].textContent.toLowerCase().includes(filter)) {
                            found = true;
                            break;
                        }
                    }
                    row.style.display = found ? "" : "none";
                });
            });
        });
    </script> -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="./script/regisID.js"></script>
</body>

</html>